<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Felicitas D. Beier" />

<meta name="date" content="2023-11-06" />

<title>mrwater Documentation</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">mrwater Documentation</h1>
<h4 class="author">Felicitas D. Beier</h4>
<h4 class="date">2023-11-06</h4>



<div id="overview" class="section level2">
<h2>Overview</h2>
<p>The following document provides a full code documentation of the
<code>mrwater</code> library including a range of arguments that can be
varied to produce cellular pre-processed water-related outputs. The
<code>fullWATER.R</code> gives an overview of functions generating the
main model outputs. It can be executed with the function call
<code>madrat:::retrieveData(WATER)</code> that will generate a .tgz file
with all relevant outputs.</p>
<div id="related-libraries" class="section level3">
<h3>Related libraries</h3>
<p>The <code>mrwater</code> library is part of the mr-universe. For more
details to the related libraries, please have a look at the respective
libraries:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(madrat)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(magclass)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(mrcommons)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(mrland)</span></code></pre></div>
</div>
<div id="input-data" class="section level3">
<h3>Input data</h3>
<p>The <code>mrwater</code> library relies on a range of input data.
Open-source data is directly downloaded and imported via
<code>downloadSource</code> and <code>readSource</code> functions that
are part of the <code>madrat</code> library. Data that is not openly
available needs to be stored in a specific folder structure
(<code>inputdata/sources/DataSource</code>) where the respective
DataSource folder must have the same name as the <code>readSource</code>
function (e.g. readRamankutty refers to the inputdata/sources/Ramankutty
folder). The read functions of this library and the underlying libraries
necessary to run the code
(e.g. <code>mrwater:::readIrrigationSystem</code>;
<code>mrcommons:::readFAO</code>; <code>mrland:::readZabel2014</code>)
access this folder to include the required data.</p>
</div>
</div>
<div id="motivation" class="section level2">
<h2>Motivation</h2>
<p>The mrwater library can be used to generate stand-alone spatially
explicit irrigation potentials (irrigation water potentials (withdrawals
and consumption) and irrigation area potentials) and (aggregated) input
data for land-system models. Potential aggregation units are spatial
clusters (based on bio-physical similarity of grid cells), country- or
basin-scale.</p>
<p>Furthermore, its outputs are a useful disaggregation tool for
land-system model outputs. For example irrigation water withdrawals from
land-use models such as MAgPIE can be disaggregated to a 0.5-degree
spatial resolution using spatially explicit irrigation potentials.</p>
<p>It is designed as hydrological input data processing tool for the
global land-use model MAgPIE (Model of Agricultural Production and its
Impact on the Environment). Nevertheless, it is applicable for other
land-system models and its spatially explicit as well as aggregated
outputs can be used for a variety of land-system models (e.g. CGEs, PEs,
etc.).</p>
<p>Note: To return spatially explicit function outputs, the
<code>madrat:::calcOutput()</code> function call must include the
argument <code>aggregate = FALSE</code>. For aggregation, a mapping is
required.</p>
</div>
<div id="hydrological-input-data" class="section level2">
<h2>Hydrological input data</h2>
<p>In this version of the mrwater library, all hydrological input data
is provided by the process-based hydrology-vegetation model LPJmL. Data
that is based on natural vegetation runs is provided by LPJmL4. Data
that includes management is based on LPJmL5.</p>
<p>The river routing consists of several functions. The first iteration
determines naturalized discharge based on yearly runoff and lake
evaporation using the STN river structure
(<code>rs &lt;- readRDS(system.file(&quot;extdata/riverstructure_stn_coord.rds&quot;, package = &quot;mrwater&quot;))</code>)
that determines the flow direction and basin attribution of the 67420
grid cells of the underlying land mask. The function returns natural
discharge and lake evaporation that are required for further
calculations in the river routing routine.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>natQ <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;RiverNaturalFlows&quot;</span>, <span class="at">selectyears =</span> <span class="dv">2010</span>,</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>                    <span class="at">climatetype =</span> <span class="st">&quot;GFDL-ESM4:ssp126&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>                    <span class="at">lpjml =</span> <span class="fu">c</span>(<span class="at">natveg =</span> <span class="st">&quot;LPJmL4_for_MAgPIE_44ac93de&quot;</span>,</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>                    <span class="at">crop =</span> <span class="st">&quot;ggcmi_phase3_nchecks_9ca735cb&quot;</span>), <span class="at">aggregate =</span> <span class="cn">FALSE</span>)[, , <span class="st">&quot;discharge_nat&quot;</span>]</span></code></pre></div>
<p>The required arguments are <code>selectyears</code> (determining the
year(s) for which the output shall be generated),
<code>climatetype</code> (selecting the GCM data and scenario underlying
the process-based vegetation model), and <code>lpjml</code> (selecting
the LPJmL model versions used for natural vegetation
(<code>natveg</code>) input data and management (<code>crop</code>)
input data)</p>
<p>Environmental flow requirements (EFRs) and accessible discharge are
also calculated based on hydrological LPJmL data only. Both are based on
monthly discharge. The calculation method and strictness of EFR can be
selected via the <code>efrMethod</code> argument (e.g. “Smakhtin:good”,
“VMF:fair”). Inaccessible discharge is based on the assumption that the
higher the long-term seasonal variability of discharge is, the harder it
is to access the water by humans and bring it into productive use.
Different accessibility rules can be selected via the
<code>accessibilityrule</code> argument (e.g. “CV:2” stands for the
coefficient of variation approach to a base of 2; “Q:75” stands for a
quantile approach where discharge that exceeds the 75th quantile is
inaccessible to humans).</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>selectyears <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>lpjml       <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">natveg =</span> <span class="st">&quot;LPJmL4_for_MAgPIE_44ac93de&quot;</span>, <span class="at">crop =</span> <span class="st">&quot;ggcmi_phase3_nchecks_bft_6277d36e&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>climatetype <span class="ot">&lt;-</span> <span class="st">&quot;GFDL-ESM4:ssp126&quot;</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>efr <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;EnvmtlFlowRequirements&quot;</span>, <span class="at">efrMethod =</span> <span class="st">&quot;VMF:fair&quot;</span>,</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>                  <span class="at">selectyears =</span> selectyears, <span class="at">climatetype =</span> climatetype, <span class="at">lpjml =</span> lpjml,</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>                  <span class="at">aggregate =</span> <span class="cn">FALSE</span>)[, , <span class="st">&quot;EFR&quot;</span>]</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>inaccessibleQ <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;DischargeInaccessible&quot;</span>, <span class="at">accessibilityrule =</span> <span class="st">&quot;CV:2&quot;</span>,</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>                            <span class="at">selectyears =</span> selectyears, <span class="at">climatetype =</span> climatetype, <span class="at">lpjml =</span> lpjml,</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>                            <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a>efrMethod         <span class="ot">&lt;-</span> <span class="st">&quot;VMF:fair&quot;</span></span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a>accessibilityrule <span class="ot">&lt;-</span> <span class="st">&quot;CV:2&quot;</span></span></code></pre></div>
<p>Note: The integration of alternative biophysical and hydrological
input data is possible.</p>
</div>
<div id="human-water-use-data" class="section level2">
<h2>Human water use data</h2>
<p>Human water abstractions are considered in consecutive river routing
iterations that reserve the respective water abstraction and update
cellular discharge respectively. They are determined through the
following function call:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>humanQ <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;RiverDischargeNatAndHuman&quot;</span>, <span class="at">iniyear =</span> <span class="dv">2010</span>, <span class="at">comAg =</span> <span class="cn">TRUE</span>,</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>                     <span class="at">selectyears =</span> selectyears, <span class="at">multicropping =</span> <span class="cn">FALSE</span>,</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>                     <span class="at">climatetype =</span> climatetype, <span class="at">lpjml =</span> lpjml,</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a>                     <span class="at">efrMethod =</span> efrMethod, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a>iniyear <span class="ot">&lt;-</span> <span class="dv">2010</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>comAg   <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span></code></pre></div>
<p>Non-agricultural water abstractions as provided by ISIMIP (and for
future scenarios WATERGAP) have priority over agricultural water
abstractions. They are determined through the function call
<code>calcOutput(&quot;RiverHumanUses&quot;, humanuse = &quot;non_agriculture&quot;, ...)</code>
and report reserved non-agricultural water consumption (“currHuman_wc”)
and withdrawal (“currHuman_ww”).</p>
<p>Taking so-called “committed agricultural uses”, i.e. reserving water
abstractions of currently irrigated areas, into account is optional (it
can be activated via the <code>com_ag</code> argument). In case of an
activation of committed agricultural uses, the required consumption and
withdrawal for currently irrigated areas as determined in
<code>calcOutput(&quot;WaterUseCommittedAg&quot;, ...)</code> are reserved in
addition to non-agricultural water abstractions via the function call
<code>calcOutput(&quot;RiverHumanUses&quot;, humanuse = &quot;committed_agriculture&quot;, ..., iniyear = 2010)</code>.
The argument <code>iniyear</code> determines the chosen cellular
irrigated crop mix (i.e. the crop mix as reported by FAOSTAT for the
year 2010 on cellular cropland as reported by LUH2). Cellular irrigated
areas for specific years are provided via
<code>calcOutput(&quot;Croparea&quot;, years = iniyear, sectoral = &quot;kcr&quot;, physical = TRUE, cells = &quot;lpjcell&quot;, cellular = TRUE, irrigation = TRUE, aggregate = FALSE)</code>
through combining (irrigated and rainfed) cropland area provided by LUH2
and country-level FAO crop production data. Note that areas reported as
irrigated depreciate at a rate of 10 percent per annum for future time
steps (years after <code>iniyear</code>).</p>
<p>Compared to the previous section, this section requires additional
input data: ISIMIP non-agricultural water abstraction data (for the
historical time period and fixed at this level for the future), WATERGAP
non-agricultural water abstraction data (for future scenarios), LPJmL5
crop water requirements, country level irrigation system shares as
provided by Jägermeyr (2015), LUH2 cellular cropland area (see also:
<code>mrcommons:::calcLUH2v2</code>), and FAO country-level
crop-specific production data (see also:
<code>mrcommons:::readFAO_online</code>).</p>
</div>
<div id="land-use-input-data" class="section level2">
<h2>Land-use input data</h2>
<p>Spatial-explicit land-use and irrigation area data provided by LUH2
(see also <code>mrcommons:::calcLUH2v2</code>). Since the LUH2 cropland
map is subdivided into only five crop functional types (C3 annuals; C4
annuals; C3 perennials; C4 perennials; C3 nitrogen fixers), we use the
spatial distribution of LUH2 and FAOSTAT information on total
country-level crop-specific production to derive spatially-explicit
crop-specific areas (see <code>mrcommons:::calcCroparea</code>). The
country-level FAOSTAT cropmix is distributed equally across physical
cropland of the respective country while maintaining the spatially
explicit cropland area distribution as provided by LUH2. The
distribution of rice area is derived more explicitly. LUH2 provides
cellular flooded area shares and only rice is flooded according to the
data set. The distribution of physical rice areas is therefore
determined by assigning the country’s rice production to flooded areas
provided at cellular level by LUH2. Aerobic (non-paddy) rice is
accounted by distributing country-level FAO rice areas beyond
country-aggregated LUH2 flooded area (i.e. where FAO reports higher
country-level rice areas than there are LUH2 flooded areas in the
respective country) equally across the remaining country’s cropland
area. Note that flooded areas are not accounted as irrigated areas. For
one, because flooded rice production is often only partially irrigated
and also because it fulfills a special management purpose in terms of
pest control.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>croparea <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;Croparea&quot;</span>, <span class="at">years =</span> iniyear, <span class="at">sectoral =</span> <span class="st">&quot;kcr&quot;</span>,</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="at">physical =</span> <span class="cn">TRUE</span>, <span class="at">cells =</span> <span class="st">&quot;lpjcell&quot;</span>, <span class="at">cellular =</span> <span class="cn">TRUE</span>, <span class="at">irrigation =</span> <span class="cn">TRUE</span>, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>The <code>physical</code> argument determines accounts for the
cropping intensity in that <code>physical = TRUE</code> returns cropland
areas that match physical area. With <code>physical = FALSE</code>
croparea can exceed physical land area, due to multicropping.</p>
</div>
<div id="irrigation-water-potentials-iwp" class="section level2">
<h2>Irrigation Water Potentials (IWP)</h2>
<p>Finally, the function
<code>calcRiverSurplusDischargeAllocation</code> determines the
allocation of “surplus discharge”, i.e. the discharge of the estuary
cell that is not (yet) consumed along the river in the last iteration of
the previous river routings that reserved environmental and human water
uses. The function returns the water that is potentially available for
irrigation considering biophysical, economic and management
constraints.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>iwp <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;RiverDischargeAllocation&quot;</span>, <span class="at">output =</span> <span class="st">&quot;potIrrigWat&quot;</span>,</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>                   <span class="at">selectyears =</span> selectyears, <span class="at">climatetype =</span> climatetype, <span class="at">lpjml =</span> lpjml,</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>                   <span class="at">efrMethod =</span> efrMethod, <span class="at">accessibilityrule =</span> accessibilityrule,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>                   <span class="at">iniyear =</span> iniyear, <span class="at">com_ag =</span> com_ag,</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>                   <span class="at">allocationrule =</span> <span class="st">&quot;optimization&quot;</span>,</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>                   <span class="at">rankmethod =</span> <span class="st">&quot;USD_ha:TRUE&quot;</span>, <span class="at">yieldcalib =</span> <span class="cn">TRUE</span>, <span class="at">cropmix =</span> <span class="st">&quot;hist_total&quot;</span>,</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>                   <span class="at">thresholdtype =</span> <span class="st">&quot;USD_ha&quot;</span>, <span class="at">gainthreshold =</span> <span class="dv">500</span>,</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>                   <span class="at">landScen =</span> <span class="st">&quot;potCropland:HalfEarth&quot;</span>,</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>                   <span class="at">irrigationsystem =</span> <span class="st">&quot;initialization&quot;</span>, <span class="at">multicropping =</span> <span class="cn">FALSE</span>, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<div id="alternative-allocation-algortihms" class="section level3">
<h3>Alternative allocation algortihms</h3>
<p>The <code>mrwater</code> library includes different surplus discharge
allocation rules representing different management strategies
(“upstreamfirst” vs. “optimization”) that can be set in the
<code>allocationrule</code> argument. The upstreamfirst algorithm allows
irrigation water abstractions provided that there is sufficient local
discharge available and a positive yield gain through irrigation
reserving these irrigation water abstractions in upstream grid cells
first following the calculation order of cells from upstream to
downstream (for more details on the river structure and calculation
order see <code>riverstructure.Rmd</code>). The optimization algorithm
ranks grid cells according to their yield value gain through irrigation
allocating available local discharge to the grid cell with the highest
productivity first, such that water resources are made available at the
most efficient location rather than upstream before downstream.</p>
</div>
<div id="economic-yield-value-gains" class="section level3">
<h3>Economic yield value gains</h3>
<p>The yield value gain can be expressed in USD per hectare irrigated
area or USD per cubic meter of irrigation water set via the
<code>unit</code> argument in
<code>calcIrrigYieldImprovementPotential</code> and via the
<code>rankmethod</code> argument in
<code>calcRiverSurplusDischargeAllocation</code>. The
<code>rankmethod</code> argument consists of two components: the unit
selections (“USD_ha” or “USD_m3”) and a boolean determining whether grid
cells are ranked according to their full yield gain potential (TRUE) or
taking a two step approach ranking according to their 75% potential and
their full potential allocating 50% of irrigation water requirements in
each of the two iterations (FALSE) separated by a “:”.</p>
<p>The yield gain through irrigation - as calculated from LPJmL5
irrigated and rainfed yields - is valued with global average crop prices
as provided by FAOSTAT (see
<code>mrcommons:::calcOutput(&quot;IniFoodPrice&quot;, datasource = &quot;FAO&quot;, products = &quot;kcr&quot;, years = NULL, year = iniyear, aggregate = FALSE))</code>.</p>
<p>Depending on the modeling application, LPJmL irrigated and rainfed
crop yields can be calibrated to meet FAO crop yields via the
<code>yieldcalib</code> argument. The <code>cropmix</code> argument
determines the selection of crops (“hist_total” refers to the cellular
cropmix as determined in <code>calcCroparea</code> considering irrigated
and rainfed areas, “hist_irrig” refers to cellular cropmix as determined
in <code>calcCroparea</code> considering only irrigated areas. Besides
these crop mixes, a selection of one or several proxycrop(s) can be
selected. This setting is relevant when calculating irrigation
potentials for the future).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>yieldGain <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;IrrigYieldImprovementPotential&quot;</span>, <span class="at">unit =</span> <span class="st">&quot;USD_ha:GLO&quot;</span>,</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>                        <span class="at">selectyears =</span> selectyears,</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>                        <span class="at">climatetype =</span> climatetype, <span class="at">lpjml =</span> lpjml,</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>                        <span class="at">iniyear =</span> iniyear,</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>                        <span class="at">cropmix =</span> <span class="st">&quot;hist_total&quot;</span>, <span class="at">yieldcalib =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>                        <span class="at">multicropping =</span> <span class="cn">FALSE</span>, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p>To represent economic aspects of irrigation, different yield value
gain thresholds can be chosen to calculate the respective IWP. It is set
via the arguments <code>thresholdtype</code> and
<code>gainthreshold</code>. The chosen valuation method is determined
via the unit argument that determines whether water or irrigation area
is valued (USD_ha or USD_m3) and whether global average prices (GLO) or
country-level agricultural prices (ISO) are used.</p>
</div>
<div id="work-in-progress" class="section level3">
<h3>Work-in-progress</h3>
<p>Please refrain from using the <code>multicropping = TRUE</code>
argument. This implementation is still work-in-progress and will be
updated soon.</p>
</div>
<div id="cropland-extent" class="section level3">
<h3>Cropland extent</h3>
<p>The irrigation potentials can be calculated for various scenarios of
potential cropland cover that are set via the <code>landScen</code>
argument. It consists of two parts: (1) the potentially available land
component where currently irrigated area (currIrrig), current cropland
area (currCropland) or potential cropland area (potCropland) can be
selected, and (2) a protection component that selects which land areas
shall be protected, i.e. no irrigation taking place in these areas.
Possible selections are: WDPA, BH, FF, CPD, LW, BH_IFL, HalfEarth. For
example <code>landScen = &quot;currCropland:NA&quot;</code> selects current
cropland extent as of the year set in iniyear without land protection;
<code>landScen = &quot;potIrrig:HalfEarth&quot;</code> is potential cropland while
respecting a Half Earth land protection scenario.</p>
</div>
<div id="irrigation-area-potential-iap" class="section level3">
<h3>Irrigation Area Potential (IAP)</h3>
<p>The <code>calcIrrigatableArea</code> function translates potential
irrigation water (PIW) into potentially irrigated areas (PIA) and
returns the area that can potentially be irrigated given the assumptions
that are set via the arguments.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>allocationrule   <span class="ot">&lt;-</span> <span class="st">&quot;optimization&quot;</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>rankmethod       <span class="ot">&lt;-</span> <span class="st">&quot;USD_ha:TRUE&quot;</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>yieldcalib       <span class="ot">&lt;-</span> <span class="cn">TRUE</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>cropmix          <span class="ot">&lt;-</span> <span class="st">&quot;hist_total&quot;</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>thresholdtype    <span class="ot">&lt;-</span> <span class="st">&quot;USD_ha&quot;</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>gainthreshold    <span class="ot">&lt;-</span> <span class="dv">500</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>landScen         <span class="ot">&lt;-</span> <span class="st">&quot;potCropland:HalfEarth&quot;</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>irrigationsystem <span class="ot">&lt;-</span> <span class="st">&quot;initialization&quot;</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>multicropping    <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>iap <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;PotIrrigAreas&quot;</span>, <span class="at">selectyears =</span> selectyears, <span class="at">iniyear =</span> iniyear,</span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>                   <span class="at">lpjml =</span> lpjml, <span class="at">climatetype =</span> climatetype,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>                   <span class="at">efrMethod =</span> efrMethod, <span class="at">accessibilityrule =</span> accessibilityrule,</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>                   <span class="at">rankmethod =</span> rankmethod, <span class="at">yieldcalib =</span> yieldcalib, <span class="at">allocationrule =</span> allocationrule,</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>                   <span class="at">thresholdtype =</span> thresholdtype, <span class="at">gainthreshold =</span> gainthreshold,</span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>                   <span class="at">irrigationsystem =</span> irrigationsystem, <span class="at">landScen =</span> landScen,</span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>                   <span class="at">cropmix =</span> cropmix, <span class="at">com_ag =</span> com_ag,</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a>                   <span class="at">potential_wat =</span> <span class="cn">TRUE</span>, <span class="at">multicropping =</span> <span class="cn">FALSE</span>, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="generation-of-potential-irrigation-area-pia-curves" class="section level3">
<h3>Generation of potential irrigation area (PIA) curves</h3>
<p>For a representation of irrigation potentials at various irrigation
yield value gains, the river routing routine has to be executed for
varying irrigation yield value gain thresholds. The generated data can
be used to create PIA curves and/or aggregated to different scales
(e.g. country-, basin-scale).</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>iad <span class="ot">&lt;-</span> <span class="fu">calcOutput</span>(<span class="st">&quot;EconOfIrrig&quot;</span>, <span class="at">scenario =</span> <span class="st">&quot;ssp2&quot;</span>, <span class="at">output =</span> <span class="st">&quot;IrrigArea&quot;</span>,</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>             <span class="at">gtrange =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">250</span>, <span class="dv">500</span>, <span class="dv">1000</span>, <span class="dv">2000</span>, <span class="dv">3000</span>), <span class="at">selectyears =</span> <span class="dv">2010</span>, <span class="at">iniyear =</span> <span class="dv">2010</span>,</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>             <span class="at">lpjml =</span> lpjml, <span class="at">climatetype =</span> climatetype, <span class="at">efrMethod =</span> efrMethod, <span class="at">accessibilityrule =</span> accessibilityrule,</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>             <span class="at">rankmethod =</span> rankmethod, <span class="at">yieldcalib =</span> yieldcalib, <span class="at">transDist =</span> transDist,</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>             <span class="at">allocationrule =</span> allocationrule, <span class="at">thresholdtype =</span> thresholdtype,</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a>             <span class="at">irrigationsystem =</span> irrigationsystem, <span class="at">landScen =</span> landScen, <span class="at">cropmix =</span> cropmix,</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>             <span class="at">potential_wat =</span> <span class="cn">TRUE</span>, <span class="at">com_ag =</span> <span class="cn">FALSE</span>, <span class="at">multicropping =</span> <span class="cn">FALSE</span>, <span class="at">aggregate =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
